<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø³Ø±Ù…Ø¯ | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: #0a0f1a;
            min-height: 100vh;
            color: #fff;
        }

        /* Layout */
        .app {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #0f1628 0%, #1a2540 100%);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 0;
            margin-bottom: 30px;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .logo-text {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(135deg, #10b981, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-section {
            margin-bottom: 25px;
        }

        .nav-title {
            font-size: 11px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            padding: 0 10px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            border-radius: 10px;
            color: #9ca3af;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 5px;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .nav-item.active {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }

        .nav-item .icon {
            font-size: 18px;
        }

        .nav-item .badge {
            margin-right: auto;
            background: #ef4444;
            color: #fff;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .nav-item .badge.success {
            background: #10b981;
        }

        /* Main Content */
        .main {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 26px;
            font-weight: 700;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981, #059669);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
        }

        .stat-card .label {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
        }

        .stat-card.pending .value {
            color: #f59e0b;
        }

        .stat-card.active .value {
            color: #3b82f6;
        }

        .stat-card.resolved .value {
            color: #10b981;
        }

        .stat-card.cancelled .value {
            color: #6b7280;
        }

        /* Reports Table */
        .reports-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tabs {
            display: flex;
            gap: 5px;
        }

        .tab {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            color: #6b7280;
            transition: all 0.2s;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .tab.active {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }

        .reports-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .report-item {
            display: flex;
            align-items: center;
            padding: 18px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.2s;
        }

        .report-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .report-item:last-child {
            border-bottom: none;
        }

        .report-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 15px;
        }

        .report-status.pending {
            background: #f59e0b;
        }

        .report-status.active {
            background: #3b82f6;
            animation: pulse 2s infinite;
        }

        .report-status.resolved {
            background: #10b981;
        }

        .report-status.cancelled {
            background: #6b7280;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .report-info {
            flex: 1;
        }

        .report-id {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .report-desc {
            font-size: 12px;
            color: #6b7280;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 300px;
        }

        .report-meta {
            text-align: left;
            font-size: 12px;
            color: #6b7280;
        }

        .report-source {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 10px;
            margin-bottom: 4px;
        }

        .report-source.public {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .report-source.auto {
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
        }

        .report-actions {
            display: flex;
            gap: 8px;
            margin-right: 15px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #9ca3af;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }

        .action-btn.analyze {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">ğŸ›¡ï¸</div>
                <span class="logo-text">Ø³Ø±Ù…Ø¯</span>
            </div>

            <nav class="nav-section">
                <div class="nav-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
                <div class="nav-item active" onclick="showSection('dashboard')">
                    <span class="icon">ğŸ“Š</span>
                    Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </div>
            </nav>

            <nav class="nav-section">
                <div class="nav-title">Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</div>
                <div class="nav-item" onclick="showSection('pending')">
                    <span class="icon">ğŸ“¥</span>
                    Ø¨Ù„Ø§ØºØ§Øª Ø¬Ø¯ÙŠØ¯Ø©
                    <span class="badge" id="pendingBadge">0</span>
                </div>
                <div class="nav-item" onclick="showSection('active')">
                    <span class="icon">ğŸ”</span>
                    Ø£Ø­Ø¯Ø§Ø« Ù†Ø´Ø·Ø©
                    <span class="badge success" id="activeBadge">0</span>
                </div>
                <div class="nav-item" onclick="showSection('resolved')">
                    <span class="icon">âœ…</span>
                    ØªÙ… Ø§Ù„Ø¶Ø¨Ø·
                </div>
                <div class="nav-item" onclick="showSection('cancelled')">
                    <span class="icon">âŒ</span>
                    Ù…Ù„ØºØ§Ø©
                </div>
            </nav>

            <nav class="nav-section">
                <div class="nav-title">Ø£Ø¯ÙˆØ§Øª</div>
                <div class="nav-item" onclick="window.open('http://localhost:8001', '_blank')">
                    <span class="icon">ğŸ¦</span>
                    Ù…Ù†ØµØ© MockX
                </div>
                <div class="nav-item" onclick="window.open('../reports-portal/index.html', '_blank')">
                    <span class="icon">ğŸ“</span>
                    Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <div class="header">
                <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="loadReports()">
                        ğŸ”„ ØªØ­Ø¯ÙŠØ«
                    </button>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card pending">
                    <div class="label">Ø¨Ù„Ø§ØºØ§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
                    <div class="value" id="statPending">0</div>
                </div>
                <div class="stat-card active">
                    <div class="label">Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„</div>
                    <div class="value" id="statActive">0</div>
                </div>
                <div class="stat-card resolved">
                    <div class="label">ØªÙ… Ø§Ù„Ø¶Ø¨Ø·</div>
                    <div class="value" id="statResolved">0</div>
                </div>
                <div class="stat-card cancelled">
                    <div class="label">Ù…Ù„ØºØ§Ø©</div>
                    <div class="value" id="statCancelled">0</div>
                </div>
            </div>

            <!-- Reports Section -->
            <div class="reports-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span>ğŸ“</span>
                        Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
                    </h2>
                    <div class="tabs">
                        <div class="tab active" data-filter="all">Ø§Ù„ÙƒÙ„</div>
                        <div class="tab" data-filter="pending">Ø¬Ø¯ÙŠØ¯Ø©</div>
                        <div class="tab" data-filter="active">Ù†Ø´Ø·Ø©</div>
                        <div class="tab" data-filter="resolved">Ù…Ø­Ù„ÙˆÙ„Ø©</div>
                    </div>
                </div>

                <div class="reports-list" id="reportsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª...
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentFilter = 'all';
        let allReports = [];

        // Load reports on page load
        document.addEventListener('DOMContentLoaded', loadReports);

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentFilter = tab.dataset.filter;
                renderReports();
            });
        });

        async function loadReports() {
            const listEl = document.getElementById('reportsList');
            listEl.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª...
                </div>
            `;

            try {
                const response = await fetch(`${API_BASE}/api/reports`);
                if (response.ok) {
                    const data = await response.json();
                    allReports = data.reports || [];
                    updateStats(data.stats || {});
                    renderReports();
                } else {
                    showError('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª');
                }
            } catch (error) {
                console.error('Error:', error);
                // Show demo data if API is not available
                showDemoData();
            }
        }

        function updateStats(stats) {
            document.getElementById('statPending').textContent = stats.pending || 0;
            document.getElementById('statActive').textContent = stats.active || 0;
            document.getElementById('statResolved').textContent = stats.resolved || 0;
            document.getElementById('statCancelled').textContent = stats.cancelled || 0;

            document.getElementById('pendingBadge').textContent = stats.pending || 0;
            document.getElementById('activeBadge').textContent = stats.active || 0;
        }

        function renderReports() {
            const listEl = document.getElementById('reportsList');

            let filtered = allReports;
            if (currentFilter !== 'all') {
                filtered = allReports.filter(r => r.status === currentFilter);
            }

            if (filtered.length === 0) {
                listEl.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“­</div>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª</p>
                    </div>
                `;
                return;
            }

            listEl.innerHTML = filtered.map(report => `
                <div class="report-item" onclick="openReport('${report.id}')">
                    <div class="report-status ${report.status}"></div>
                    <div class="report-info">
                        <div class="report-id">#${report.id}</div>
                        <div class="report-desc">${report.description || 'Ø¨Ø¯ÙˆÙ† ÙˆØµÙ'}</div>
                    </div>
                    <div class="report-meta">
                        <div class="report-source ${report.source === 'public' ? 'public' : 'auto'}">
                            ${report.source === 'public' ? 'ğŸ‘¤ Ø¨Ù„Ø§Øº Ø¹Ø§Ù…' : 'ğŸ¤– Ø±ØµØ¯ Ø¢Ù„ÙŠ'}
                        </div>
                        <div>${formatDate(report.created_at)}</div>
                    </div>
                    <div class="report-actions">
                        ${report.status === 'pending' ? `
                            <button class="action-btn analyze" onclick="event.stopPropagation(); activateReport('${report.id}')" title="Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„">
                                â–¶ï¸
                            </button>
                        ` : ''}
                        ${report.status === 'active' ? `
                            <button class="action-btn analyze" onclick="event.stopPropagation(); openAnalysis('${report.id}')" title="ÙØªØ­ Ø§Ù„ØªØ­Ù„ÙŠÙ„">
                                ğŸ”
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function formatDate(isoString) {
            if (!isoString) return '';
            const date = new Date(isoString);
            return date.toLocaleDateString('ar-SA', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        async function activateReport(id) {
            try {
                const response = await fetch(`${API_BASE}/api/reports/${id}/activate`, {
                    method: 'POST'
                });
                if (response.ok) {
                    loadReports();
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function openReport(id) {
            const report = allReports.find(r => r.id === id);
            if (report && report.status === 'active') {
                openAnalysis(id);
            } else {
                alert(`ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§Øº: ${id}`);
            }
        }

        function openAnalysis(id) {
            window.location.href = `analysis.html?id=${id}`;
        }

        function showSection(section) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');

            // Filter based on section
            if (section === 'dashboard') {
                currentFilter = 'all';
            } else {
                currentFilter = section;
            }

            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.filter === currentFilter ||
                    (currentFilter === 'all' && tab.dataset.filter === 'all'));
            });

            renderReports();
        }

        function showError(msg) {
            const listEl = document.getElementById('reportsList');
            listEl.innerHTML = `
                <div class="empty-state">
                    <div class="icon">âš ï¸</div>
                    <p>${msg}</p>
                </div>
            `;
        }

        function showDemoData() {
            // Demo data when API is not available
            allReports = [
                {
                    id: 'A1B2C3D4',
                    tweet_url: 'https://x.com/user1/status/123',
                    description: 'Ù…Ø­ØªÙˆÙ‰ ÙŠØ­Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ù',
                    status: 'pending',
                    source: 'public',
                    created_at: new Date().toISOString()
                },
                {
                    id: 'E5F6G7H8',
                    tweet_url: 'https://x.com/user2/status/456',
                    description: 'Ù†Ø´Ø± Ø´Ø§Ø¦Ø¹Ø§Øª ÙƒØ§Ø°Ø¨Ø©',
                    status: 'active',
                    source: 'auto_monitor',
                    created_at: new Date(Date.now() - 3600000).toISOString()
                },
                {
                    id: 'I9J0K1L2',
                    tweet_url: 'https://x.com/user3/status/789',
                    description: 'Ù…Ø­ØªÙˆÙ‰ Ù…Ø³ÙŠØ¡',
                    status: 'resolved',
                    source: 'public',
                    created_at: new Date(Date.now() - 86400000).toISOString()
                }
            ];

            updateStats({
                pending: 1,
                active: 1,
                resolved: 1,
                cancelled: 0
            });

            renderReports();
        }
    </script>
</body>

</html>